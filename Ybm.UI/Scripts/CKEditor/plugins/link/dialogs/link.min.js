CKEDITOR.dialog.add("link",function(n){function c(n){return n.replace(/'/g,"\\$&")}function a(n){for(var u=s,r,f,t=[h,"("],i=0;i<u.length;i++)r=u[i].toLowerCase(),f=n[r],0<i&&t.push(","),t.push("'",f?c(encodeURIComponent(n[r])):"","'");return t.push(")"),t.join("")}function v(n){for(var i,u=n.length,r=[],t=0;t<u;t++)i=n.charCodeAt(t),r.push(i);return"String.fromCharCode("+r.join(",")+")"}function y(n){return(n=n.getAttribute("class"))?n.replace(/\s*(?:cke_anchor_empty|cke_anchor)(?:\s*$)?/g,""):""}var s,h,p=CKEDITOR.plugins.link,l=function(){var t=this.getDialog(),i=t.getContentElement("target","popupFeatures"),t=t.getContentElement("target","linkTargetName"),r=this.getValue();if(i&&t)switch(i=i.getElement(),i.hide(),t.setValue(""),r){case"frame":t.setLabel(n.lang.link.targetFrameName);t.getElement().show();break;case"popup":i.show();t.setLabel(n.lang.link.targetPopupName);t.getElement().show();break;default:t.setValue(r);t.getElement().hide()}},w=/^javascript:/,b=/^mailto:([^?]+)(?:\?(.+))?$/,k=/subject=([^;?:@&=$,\/]*)/,d=/body=([^;?:@&=$,\/]*)/,g=/^#(.*)$/,nt=/^((?:http|https|ftp|news):\/\/)?(.*)$/,tt=/^(_(?:self|top|parent|blank))$/,it=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,rt=/^javascript:([^(]+)\(([^)]+)\)$/,ut=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,ft=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,et=function(n,t){var i=t&&(t.data("cke-saved-href")||t.getAttribute("href"))||"",r,e,u={},f,c;if(i.match(w)&&("encode"==o?i=i.replace(it,function(n,t,i){return"mailto:"+String.fromCharCode.apply(String,t.split(","))+(i&&i.replace(/\\'/g,"'"))}):o&&i.replace(rt,function(n,t,i){if(t==h){u.type="email";for(var n=u.email={},t=/(^')|('$)/g,i=i.match(/[^,\s]+/g),o=i.length,r,f,e=0;e<o;e++)r=decodeURIComponent,f=i[e].replace(t,"").replace(/\\'/g,"'"),f=r(f),r=s[e].toLowerCase(),n[r]=f;n.address=[n.name,n.domain].join("@")}})),u.type||((r=i.match(g))?(u.type="anchor",u.anchor={},u.anchor.name=u.anchor.id=r[1]):(r=i.match(b))?(e=i.match(k),i=i.match(d),u.type="email",f=u.email={},f.address=r[1],e&&(f.subject=decodeURIComponent(e[1])),i&&(f.body=decodeURIComponent(i[1]))):i&&(e=i.match(nt))?(u.type="url",u.url={},u.url.protocol=e[1],u.url.url=e[2]):u.type="url"),t){if(r=t.getAttribute("target"),u.target={},u.adv={},r)r.match(tt)?u.target.type=u.target.name=r:(u.target.type="frame",u.target.name=r);else if(r=(r=t.data("cke-pa-onclick")||t.getAttribute("onclick"))&&r.match(ut))for(u.target.type="popup",u.target.name=r[1];i=ft.exec(r[2]);)("yes"==i[2]||"1"==i[2])&&!(i[1]in{height:1,width:1,top:1,left:1})?u.target[i[1]]=!0:isFinite(i[2])&&(u.target[i[1]]=i[2]);r=function(n,i){var r=t.getAttribute(i);null!==r&&(u.adv[n]=r||"")};r("advId","id");r("advLangDir","dir");r("advAccessKey","accessKey");u.adv.advName=t.data("cke-saved-name")||t.getAttribute("name")||"";r("advLangCode","lang");r("advTabIndex","tabindex");r("advTitle","title");r("advContentType","type");CKEDITOR.plugins.link.synAnchorSelector?u.adv.advCSSClasses=y(t):r("advCSSClasses","class");r("advCharset","charset");r("advStyles","style");r("advRel","rel")}if(r=u.anchors=[],CKEDITOR.plugins.link.emptyAnchorFix)for(f=n.document.getElementsByTag("a"),i=0,e=f.count();i<e;i++)(c=f.getItem(i),c.data("cke-saved-name")||c.hasAttribute("name"))&&r.push({name:c.data("cke-saved-name")||c.getAttribute("name"),id:c.getAttribute("id")});else for(f=new CKEDITOR.dom.nodeList(n.document.$.anchors),i=0,e=f.count();i<e;i++)c=f.getItem(i),r[i]={name:c.getAttribute("name"),id:c.getAttribute("id")};if(CKEDITOR.plugins.link.fakeAnchor)for(f=n.document.getElementsByTag("img"),i=0,e=f.count();i<e;i++)(c=CKEDITOR.plugins.link.tryRestoreFakeAnchor(n,f.getItem(i)))&&r.push({name:c.getAttribute("name"),id:c.getAttribute("id")});return this._.selectedElement=t,u},r=function(n){n.target&&this.setValue(n.target[this.id]||"")},u=function(n){n.adv&&this.setValue(n.adv[this.id]||"")},f=function(n){n.target||(n.target={});n.target[this.id]=this.getValue()||""},e=function(n){n.adv||(n.adv={});n.adv[this.id]=this.getValue()||""},o=n.config.emailProtection||"",i,t;return o&&"encode"!=o&&(h=s=void 0,o.replace(/^([^(]+)\(([^)]+)\)$/,function(n,t,i){h=t;s=[];i.replace(/[^,\s]+/g,function(n){s.push(n)})})),i=n.lang.common,t=n.lang.link,{title:t.title,minWidth:350,minHeight:230,contents:[{id:"info",label:t.info,title:t.info,elements:[{id:"linkType",type:"select",label:t.type,"default":"url",items:[[t.toUrl,"url"],[t.toAnchor,"anchor"],[t.toEmail,"email"]],onChange:function(){var i=this.getDialog(),u=["urlOptions","anchorOptions","emailOptions"],f=this.getValue(),t=i.definition.getContents("upload"),t=t&&t.hidden,r;for(f=="url"?(n.config.linkShowTargetTab&&i.showPage("target"),t||i.showPage("upload")):(i.hidePage("target"),t||i.hidePage("upload")),t=0;t<u.length;t++)r=i.getContentElement("info",u[t]),r&&(r=r.getElement().getParent().getParent(),u[t]==f+"Options"?r.show():r.hide());i.layout()},setup:function(n){n.type&&this.setValue(n.type)},commit:function(n){n.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:i.protocol,"default":"http://",items:[["http://‎","http://"],["https://‎","https://"],["ftp://‎","ftp://"],["news://‎","news://"],[t.other,""]],setup:function(n){n.url&&this.setValue(n.url.protocol||"")},commit:function(n){n.url||(n.url={});n.url.protocol=this.getValue()}},{type:"text",id:"url",label:i.url,required:!0,onLoad:function(){this.allowOnChange=!0},onKeyUp:function(){this.allowOnChange=!1;var i=this.getDialog().getContentElement("info","protocol"),n=this.getValue(),t=/^(http|https|ftp|news):\/\/(?=.)/i.exec(n);t?(this.setValue(n.substr(t[0].length)),i.setValue(t[0].toLowerCase())):/^((javascript:)|[#\/\.\?])/i.test(n)&&i.setValue("");this.allowOnChange=!0},onChange:function(){this.allowOnChange&&this.onKeyUp()},validate:function(){var n=this.getDialog();return n.getContentElement("info","linkType")&&n.getValueOf("info","linkType")!="url"?!0:/javascript\:/.test(this.getValue())?(alert(i.invalidValue),!1):this.getDialog().fakeObj?!0:CKEDITOR.dialog.validate.notEmpty(t.noUrl).apply(this)},setup:function(n){this.allowOnChange=!1;n.url&&this.setValue(n.url.url);this.allowOnChange=!0},commit:function(n){this.onChange();n.url||(n.url={});n.url.url=this.getValue();this.allowOnChange=!1}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().show()}},{type:"button",id:"browse",hidden:"true",filebrowser:"info:url",label:i.browseServer}]},{type:"vbox",id:"anchorOptions",width:260,align:"center",padding:0,children:[{type:"fieldset",id:"selectAnchorText",label:t.selectAnchor,setup:function(n){n.anchors.length>0?this.getElement().show():this.getElement().hide()},children:[{type:"hbox",id:"selectAnchor",children:[{type:"select",id:"anchorName","default":"",label:t.anchorName,style:"width: 100%;",items:[[""]],setup:function(n){this.clear();this.add("");for(var t=0;t<n.anchors.length;t++)n.anchors[t].name&&this.add(n.anchors[t].name);n.anchor&&this.setValue(n.anchor.name);(n=this.getDialog().getContentElement("info","linkType"))&&n.getValue()=="email"&&this.focus()},commit:function(n){n.anchor||(n.anchor={});n.anchor.name=this.getValue()}},{type:"select",id:"anchorId","default":"",label:t.anchorId,style:"width: 100%;",items:[[""]],setup:function(n){this.clear();this.add("");for(var t=0;t<n.anchors.length;t++)n.anchors[t].id&&this.add(n.anchors[t].id);n.anchor&&this.setValue(n.anchor.id)},commit:function(n){n.anchor||(n.anchor={});n.anchor.id=this.getValue()}}],setup:function(n){n.anchors.length>0?this.getElement().show():this.getElement().hide()}}]},{type:"html",id:"noAnchors",style:"text-align: center;",html:'<div role="note" tabIndex="-1">'+CKEDITOR.tools.htmlEncode(t.noAnchors)+"<\/div>",focus:!0,setup:function(n){n.anchors.length<1?this.getElement().show():this.getElement().hide()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:t.emailAddress,required:!0,validate:function(){var n=this.getDialog();return!n.getContentElement("info","linkType")||n.getValueOf("info","linkType")!="email"?!0:CKEDITOR.dialog.validate.notEmpty(t.noEmail).apply(this)},setup:function(n){n.email&&this.setValue(n.email.address);(n=this.getDialog().getContentElement("info","linkType"))&&n.getValue()=="email"&&this.select()},commit:function(n){n.email||(n.email={});n.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:t.emailSubject,setup:function(n){n.email&&this.setValue(n.email.subject)},commit:function(n){n.email||(n.email={});n.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:t.emailBody,rows:3,"default":"",setup:function(n){n.email&&this.setValue(n.email.body)},commit:function(n){n.email||(n.email={});n.email.body=this.getValue()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}}]},{id:"target",requiredContent:"a[target]",label:t.target,title:t.target,elements:[{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:i.target,"default":"notSet",style:"width : 100%;",items:[[i.notSet,"notSet"],[t.targetFrame,"frame"],[t.targetPopup,"popup"],[i.targetNew,"_blank"],[i.targetTop,"_top"],[i.targetSelf,"_self"],[i.targetParent,"_parent"]],onChange:l,setup:function(n){n.target&&this.setValue(n.target.type||"notSet");l.call(this)},commit:function(n){n.target||(n.target={});n.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:t.targetFrameName,"default":"",setup:function(n){n.target&&this.setValue(n.target.name)},commit:function(n){n.target||(n.target={});n.target.name=this.getValue().replace(/\W/gi,"")}}]},{type:"vbox",width:"100%",align:"center",padding:2,id:"popupFeatures",children:[{type:"fieldset",label:t.popupFeatures,children:[{type:"hbox",children:[{type:"checkbox",id:"resizable",label:t.popupResizable,setup:r,commit:f},{type:"checkbox",id:"status",label:t.popupStatusBar,setup:r,commit:f}]},{type:"hbox",children:[{type:"checkbox",id:"location",label:t.popupLocationBar,setup:r,commit:f},{type:"checkbox",id:"toolbar",label:t.popupToolbar,setup:r,commit:f}]},{type:"hbox",children:[{type:"checkbox",id:"menubar",label:t.popupMenuBar,setup:r,commit:f},{type:"checkbox",id:"fullscreen",label:t.popupFullScreen,setup:r,commit:f}]},{type:"hbox",children:[{type:"checkbox",id:"scrollbars",label:t.popupScrollBars,setup:r,commit:f},{type:"checkbox",id:"dependent",label:t.popupDependent,setup:r,commit:f}]},{type:"hbox",children:[{type:"text",widths:["50%","50%"],labelLayout:"horizontal",label:i.width,id:"width",setup:r,commit:f},{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:t.popupLeft,id:"left",setup:r,commit:f}]},{type:"hbox",children:[{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:i.height,id:"height",setup:r,commit:f},{type:"text",labelLayout:"horizontal",label:t.popupTop,widths:["50%","50%"],id:"top",setup:r,commit:f}]}]}]}]},{id:"upload",label:t.upload,title:t.upload,hidden:!0,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:i.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:i.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:t.advanced,title:t.advanced,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",id:"advId",requiredContent:"a[id]",label:t.id,setup:u,commit:e},{type:"select",id:"advLangDir",requiredContent:"a[dir]",label:t.langDir,"default":"",style:"width:110px",items:[[i.notSet,""],[t.langDirLTR,"ltr"],[t.langDirRTL,"rtl"]],setup:u,commit:e},{type:"text",id:"advAccessKey",requiredContent:"a[accesskey]",width:"80px",label:t.acccessKey,maxLength:1,setup:u,commit:e}]},{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",label:t.name,id:"advName",requiredContent:"a[name]",setup:u,commit:e},{type:"text",label:t.langCode,id:"advLangCode",requiredContent:"a[lang]",width:"110px","default":"",setup:u,commit:e},{type:"text",label:t.tabIndex,id:"advTabIndex",requiredContent:"a[tabindex]",width:"80px",maxLength:5,setup:u,commit:e}]}]},{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:t.advisoryTitle,requiredContent:"a[title]","default":"",id:"advTitle",setup:u,commit:e},{type:"text",label:t.advisoryContentType,requiredContent:"a[type]","default":"",id:"advContentType",setup:u,commit:e}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:t.cssClasses,requiredContent:"a(cke-xyz)","default":"",id:"advCSSClasses",setup:u,commit:e},{type:"text",label:t.charset,requiredContent:"a[charset]","default":"",id:"advCharset",setup:u,commit:e}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:t.rel,requiredContent:"a[rel]","default":"",id:"advRel",setup:u,commit:e},{type:"text",label:t.styles,requiredContent:"a{cke-xyz}","default":"",id:"advStyles",validate:CKEDITOR.dialog.validate.inlineStyle(n.lang.common.invalidInlineStyle),setup:u,commit:e}]}]}]}],onShow:function(){var t=this.getParentEditor(),i=t.getSelection(),n=null;(n=p.getSelectedLink(t))&&n.hasAttribute("href")?i.getSelectedElement()||i.selectElement(n):n=null;this.setupContent(et.apply(this,[t,n]))},onOk:function(){var u={},e=[],t={},r=this.getParentEditor(),f,i,n;this.commitContent(t);switch(t.type||"url"){case"url":n=t.url&&t.url.protocol!=void 0?t.url.protocol:"http://";f=t.url&&CKEDITOR.tools.trim(t.url.url)||"";u["data-cke-saved-href"]=f.indexOf("/")===0?f:n+f;break;case"anchor":n=t.anchor&&t.anchor.id;u["data-cke-saved-href"]="#"+(t.anchor&&t.anchor.name||n||"");break;case"email":i=t.email;n=i.address;switch(o){case"":case"encode":var f=encodeURIComponent(i.subject||""),s=encodeURIComponent(i.body||""),i=[];f&&i.push("subject="+f);s&&i.push("body="+s);i=i.length?"?"+i.join("&"):"";o=="encode"?(n=["javascript:void(location.href='mailto:'+",v(n)],i&&n.push("+'",c(i),"'"),n.push(")")):n=["mailto:",n,i];break;default:n=n.split("@",2);i.name=n[0];i.domain=n[1];n=["javascript:",a(i)]}u["data-cke-saved-href"]=n.join("")}if(t.target)if(t.target.type=="popup"){for(var n=["window.open(this.href, '",t.target.name||"","', '"],h=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"],f=h.length,i=function(n){t.target[n]&&h.push(n+"="+t.target[n])},s=0;s<f;s++)h[s]=h[s]+(t.target[h[s]]?"=yes":"=no");i("width");i("left");i("height");i("top");n.push(h.join(","),"'); return false;");u["data-cke-pa-onclick"]=n.join("");e.push("target")}else t.target.type!="notSet"&&t.target.name?u.target=t.target.name:e.push("target"),e.push("data-cke-pa-onclick","onclick");t.adv&&(n=function(n,i){var r=t.adv[n];r?u[i]=r:e.push(i)},n("advId","id"),n("advLangDir","dir"),n("advAccessKey","accessKey"),t.adv.advName?u.name=u["data-cke-saved-name"]=t.adv.advName:e=e.concat(["data-cke-saved-name","name"]),n("advLangCode","lang"),n("advTabIndex","tabindex"),n("advTitle","title"),n("advContentType","type"),n("advCSSClasses","class"),n("advCharset","charset"),n("advStyles","style"),n("advRel","rel"));n=r.getSelection();u.href=u["data-cke-saved-href"];this._.selectedElement?(r=this._.selectedElement,f=r.data("cke-saved-href"),i=r.getHtml(),r.setAttributes(u),r.removeAttributes(e),t.adv&&t.adv.advName&&CKEDITOR.plugins.link.synAnchorSelector&&r.addClass(r.getChildCount()?"cke_anchor":"cke_anchor_empty"),(f==i||t.type=="email"&&i.indexOf("@")!=-1)&&(r.setHtml(t.type=="email"?t.email.address:u["data-cke-saved-href"]),n.selectElement(r)),delete this._.selectedElement):(n=n.getRanges()[0],n.collapsed&&(r=new CKEDITOR.dom.text(t.type=="email"?t.email.address:u["data-cke-saved-href"],r.document),n.insertNode(r),n.selectNodeContents(r)),r=new CKEDITOR.style({element:"a",attributes:u}),r.type=CKEDITOR.STYLE_INLINE,r.applyToRange(n),n.select())},onLoad:function(){n.config.linkShowAdvancedTab||this.hidePage("advanced");n.config.linkShowTargetTab||this.hidePage("target")},onFocus:function(){var n=this.getContentElement("info","linkType");n&&n.getValue()=="url"&&(n=this.getContentElement("info","url"),n.select())}}});
//# sourceMappingURL=link.min.js.map
